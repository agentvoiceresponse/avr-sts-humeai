# Agent Voice Response - HumeAI Speech-to-Speech Integration

[![Discord](https://img.shields.io/discord/1347239846632226998?label=Discord&logo=discord)](https://discord.gg/DFTU69Hg74)
[![GitHub Repo stars](https://img.shields.io/github/stars/agentvoiceresponse/avr-sts-humeai?style=social)](https://github.com/agentvoiceresponse/avr-sts-humeai)
[![Docker Pulls](https://img.shields.io/docker/pulls/agentvoiceresponse/avr-sts-humeai?label=Docker%20Pulls&logo=docker)](https://hub.docker.com/r/agentvoiceresponse/avr-sts-humeai)
[![Ko-fi](https://img.shields.io/badge/Support%20us%20on-Ko--fi-ff5e5b.svg)](https://ko-fi.com/agentvoiceresponse)

This repository showcases the integration between **Agent Voice Response** and **HumeAI's Real-time Speech-to-Speech API**. The application leverages HumeAI's powerful language model to process audio input from users, providing intelligent, context-aware responses in real-time audio format.

## Prerequisites

To set up and run this project, you will need:

1. **Node.js** and **npm** installed
2. A **HumeAI API key** with access to the real-time API
3. **WebSocket** support in your environment

## Setup

### 1. Clone the Repository

```bash
git clone https://github.com/agentvoiceresponse/avr-sts-humeai.git
cd avr-sts-humeai
```

### 2. Install Dependencies

```bash
npm install
```

### 3. Configure Environment Variables

Create a `.env` file in the root of the project to store your API keys and configuration. You will need to add the following variables:

```bash
HUMEAI_API_KEY=your_HumeAI_api_key
PORT=6039
# Optional: override defaults or use preconfigured resources
HUMEAI_WS_URL=wss://api.hume.ai/v0/evi/chat
HUMEAI_WELCOME_MESSAGE="Hello, how can I help you today?"
HUMEAI_INSTRUCTIONS="You are a helpful assistant"
HUMEAI_CONFIG_ID=
HUMEAI_VOICE_ID=
```
### 4. Running the Application

Start the application by running the following command:

```bash
npm run start:dev
```

The server will start on the port defined in the environment variable (default: 6039).

## How It Works

The **Agent Voice Response** system integrates with HumeAI's Real-time Speech-to-Speech API to provide intelligent audio-based responses to user queries. The server receives audio input from users, forwards it to HumeAI's API, and then returns the model's response as audio in real-time using WebSocket communication.

### Key Components

- **Express.js Server**: Handles incoming audio streams from clients
- **WebSocket Communication**: Manages real-time communication with HumeAI's API
- **Real-time Streaming**: Processes and streams audio data in real-time
- **Tool Usage**: Tool usage consistent with other implementations in the ecosystem

## API Endpoints

### POST `/speech-to-speech-stream`

This endpoint accepts an audio stream and returns a streamed audio response generated by HumeAI.

**Request:**
- Content-Type: audio/x-raw
- Format: 16-bit PCM at 8kHz
- Method: POST

**Response:**
- Content-Type: text/event-stream
- Format: 16-bit PCM at 8kHz
- Streamed audio data in real-time

## Customizing the Application

### Environment Variables

You can customize the application behavior using the following environment variables:

- `PORT`: The port on which the server will listen (default: 6039).
- `HUMEAI_API_KEY`: Your HumeAI API key (required).

With config
- `HUMEAI_CONFIG_ID`: HumeAI config ID. When set, the server uses it instead of `HUMEAI_WELCOME_MESSAGE`/`HUMEAI_INSTRUCTIONS`/`HUMEAI_VOICE_ID`.

Without config
- `HUMEAI_WELCOME_MESSAGE`: Greeting sent to the assistant at session start (default: `Hello, how can I help you today?`).
- `HUMEAI_INSTRUCTIONS`: System prompt used when no config ID is supplied (default: `You are a helpful assistant`).
- `HUMEAI_VOICE_ID`: Optional voice ID used when `HUMEAI_CONFIG_ID` is not provided.

Optional
- `HUMEAI_WS_URL`: WebSocket endpoint for HumeAI (default: `wss://api.hume.ai/v0/evi/chat`).

## Error Handling

The application includes comprehensive error handling for:
- WebSocket connection issues
- Audio processing errors
- HumeAI API errors
- Stream processing errors

All errors are logged to the console and appropriate error messages are returned to the client.

## Support & Community

*   **GitHub:** [https://github.com/agentvoiceresponse](https://github.com/agentvoiceresponse) - Report issues, contribute code.
*   **Discord:** [https://discord.gg/DFTU69Hg74](https://discord.gg/DFTU69Hg74) - Join the community discussion.
*   **Docker Hub:** [https://hub.docker.com/u/agentvoiceresponse](https://hub.docker.com/u/agentvoiceresponse) - Find Docker images.
*   **NPM:** [https://www.npmjs.com/~agentvoiceresponse](https://www.npmjs.com/~agentvoiceresponse) - Browse our packages.
*   **Wiki:** [https://wiki.agentvoiceresponse.com/en/home](https://wiki.agentvoiceresponse.com/en/home) - Project documentation and guides.

## Support AVR

AVR is free and open-source. If you find it valuable, consider supporting its development:

<a href="https://ko-fi.com/agentvoiceresponse" target="_blank"><img src="https://ko-fi.com/img/githubbutton_sm.svg" alt="Support us on Ko-fi"></a>

## License

MIT License - see the [LICENSE](LICENSE.md) file for details.
